<head>
  <style>
    body { 
      background-color: 104b6b; 
      font-family: "arial"; 
      text-align: center;
      border-radius: 5;
      color: white;
    }
  </style>
  <title>page</title>
</head>

<body>
  <main>
    <h1>page</h1>
    <p>Make a new public webpage at [your-ship-url]/apps/feature/[name]</p>
    <form action=javascript:postNewPage()>
      <label for="Name">Name:</label>
      <input type="text" id="nameBox"><br><br>
      <label for="HTML">HTML:</label>
      <input type="text" id="htmlBox"><br><br>
      <input type="submit" value="Create Page">
    </form>
    <br>
    <h3>My Pages</h3>
    <div id="delete-buttons"></div>
    <script>
    

function post(tag, data) {
    fetch('/apps/page', {
        method: 'POST',
        body: JSON.stringify({[tag]: data})
    })
    location.reload()
}

getState()
    .then((state) => renderPage(state))

async function getState() {
    const response = await fetch('/apps/page/state')
    return response.json()
}


function postNewPage()
{
    post("new-page", [document.getElementById('nameBox').value, document.getElementById('htmlBox').value]);
}

function postDeletePage()
{
    var page = event.currentTarget.myPage;
    post("delete-page", page);
}

function renderPage(state)
{
    const deletions = document.getElementById("delete-buttons");

    for(var i = 0; i < state.length; i++)
    {
        const page = document.createElement("div");
        page.textContent = state[i][0] + "     ";
        deletions.appendChild(page);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.myPage = state[i][0]
        deleteButton.addEventListener('click', postDeletePage);
        page.appendChild(deleteButton);

        page.appendChild(document.createElement("br"));
        page.appendChild(document.createElement("br"));
    }
}

</script>
</main>