<head>
  <style>
    * {
      font-family: "arial";
    }

    body {
      background-color: #000c13;
      color: white;
      width: 99%;
      overflow: hidden;
      height: 80vh;
    }

    .name-label {
      font-weight: bold;
      top: 20px;
      font-size: 18px;
      left: 10px;
    }

    .name-input {
      left: 80px !important;
      top: 12px;
      font-size: 16px;
      background-color: #111928;
      color: white;
      font-weight: bold;
      border: none;
      padding: 10px;
    }

    .create-page-btn {
      border: none;
      padding: 10px;
      padding-left: 8px;
      padding-right: 8px;
      font-size: 16px !important;
      z-index: 50 !important;
      cursor: pointer;
      right: 20px;
      top: 10px;
      background-color: #111928;
      color: white;
      font-weight: bold;
    }

    .border-light-blue {
      border: 1px solid #146e91dc;
    }

    .z-index-10 {
      z-index: 10;
    }

    .border-radius-10 {
      border-radius: 10px;
    }

    .page-btn {
      padding: 10px;
      padding-left: 8px;
      top: 10px;
      right: 140px;
      padding-right: 8px;
      font-size: 16px !important;
      cursor: pointer;
      background-color: #111928;
      color: white;
      font-weight: bold;
    }

    .hover:hover {
      background-color: #146e91dc;
    }

    .html-label {
      font-weight: bold;
      margin-left: 10px;
      top: 60px;
      left: 0px;
      font-size: 16px;
      z-index: 1 !important;
    }

    .fixed {
      position: fixed;
    }

    .modal {
      top: 130px;
      width: 500px;
      height: 690px;
      z-index: -4;
      opacity: 0;
      transition: .2s;
    }

    .big-modal {
      top: 170px;
      width: 700px;
      height: 700px;
      z-index: -4;
      opacity: 0;
      transition: .2s;
    }

    .small-modal {
      top: 170px;
      width: 400px;
      height: 200px;
      z-index: -4;
      opacity: 0;
      transition: .2s;
    }

    .box-shadow {
      box-shadow: 0px 0px 10px 0px #000000;
    }

    .modal-container {
      display: flex;
      justify-content: center;
    }

    .close {
      float: right;
      margin-top: -73px;
      margin-right: 20px;
      font-size: 50px !important;
      cursor: pointer;
    }

    .my-modal-title {
      float: left;
      margin-left: 10px;
      font-size: 30px !important;
      margin-top: -62px;
    }

    .modal-line {
      margin-top: 70px;
    }

    .page-h1 {
      font-size: 30px;
      margin-top: -70px;
      background-color: #111928;
      border: 1px solid #146e91dc;
      padding: 10px;
    }

    .info {
      font-size: 16px;
      top: 60px;
    }

    #codeInput {
      left: 60px !important;
      top: 92px !important;
      z-index: 0;
      height: 180000px;
    }

    .absolute {
      position: absolute;
    }

    textarea {
      z-index: 25 !important;
    }

    .bottom-right-items {
      bottom: 15px;
      right: 0px;
      margin-right: 10px;
      margin-bottom: 20px;
    }

    .light-blue-gradient {
      background: rgb(16, 75, 107);
      background: linear-gradient(90deg, rgba(16, 75, 107, 1) 0%, rgba(16, 75, 107, 1) 43%, rgba(52, 129, 241, 1) 100%);
    }

    .bottom-right-item {
      padding: 20px;
      font-size: 15px;
      width: 100px !important;
      display: inline;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
      margin-top: 5px;
      padding-left: 30px;
      padding-right: 30px;
    }

    .width-100 {
      width: 100%;
    }

    .dark-blue-gradient {
      background: rgb(16, 75, 107);
      background: radial-gradient(circle, rgba(16, 75, 107, 1) 0%, rgba(0, 0, 0, 1) 100%);
    }

    .top-bar {
      top: 0px;
      left: 0px;
      height: 100px !important;
    }

    .gutter {
      top: 100px;
      display: block;
      width: 73px;
      left: 0;
      height: 100% !important;
      background-color: #01121b;
    }

    .justify-content-center {
      display: flex;
      justify-content: center;
    }

    .scroll-to-top {
      position: fixed;
      top: -100000000px;
      left: 0px;
    }

    .icon {
      margin-left: -20px;
      margin-top: -10px;
      font-size: 40px !important;
    }

    .no-select {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    #codeMirror {
      top: 0px;
      width: 98% !important;
      height: 70.9% !important;
      z-index: 0;
    }

    .CodeMirror {
      position: fixed;
      height: 50%;
      font-family: arial, monospace;
      font-size: 16px;
      left: 66px;
    }

    .settings {
      margin-left: 6.5px;
      margin-top: 5px;
      width: 60px;
      cursor: pointer;
    }

    .page-list-item {
      padding-right: 8px;
      font-size: 16px !important;
      cursor: pointer;
      background-color: #111928;
      color: white;
      font-weight: bold;
      border: 1px solid #146e91dc;
      margin-left: 10px;
      border-radius: 10px;;
      position: static;
      margin-top: 10px;
      width: 96%;
    }

    .del {
      float: right;
      background-color: red;
      border: none; 
      color: white;
      border-radius: 10px;
      padding: 7px;
      margin-top: 3px;
      font-weight: bold;
      border: 2px rgb(19, 1, 1) solid;
    }

    .modal-btn {
      position: fixed;
      background-color: #000c13;
      color: white;
      width: 170px;
      padding: 20px;
      cursor: pointer;
      margin: 20px;
      border: 1px solid #146e91dc;
      font-weight: bold;
      margin-left: 115px !important;;
    }

    .modal-btn:hover {
      background-color: #146e91dc;
    }

    .del:hover {
      background-color: darkred;
      cursor: pointer;
    }

    .pages-title {
      font-size: 16px;
      background-color: #111928;
      padding: 10px;
      float: left;
    }

    @media screen and (max-width: 860px) {
      .page-h1 {
        visibility: hidden;
      }

      .info {
        visibility: hidden;
      }

      .name-input {
        width: 150px;
      }
    }
  </style>

  <title>page</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/rubyblue.min.css"
    integrity="sha512-pt+OhZW7o2pmHEahNFroPWkGR89L0tmDqCzXK+7WM1vGLtUyxms1JxZsXgJbOdFwylRnEt0yHnU6y2uAs40FxQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css"
    integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"
    integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/xml/xml.min.js"
    integrity="sha512-LarNmzVokUmcA7aUDtqZ6oTS+YXmUKzpGdm8DxC46A6AHu+PQiYCUlwEGWidjVYMo/QXZMFMIadZtrkfApYp/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js"
    integrity="sha512-I6CdJdruzGtvDyvdO4YsiAq+pkWf2efgd1ZUSK2FnM/u2VuRASPC7GowWQrWyjxCZn6CT89s3ddGI+be0Ak9Fg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/css/css.min.js"
    integrity="sha512-rQImvJlBa8MV1Tl1SXR5zD2bWfmgCEIzTieFegGg89AAt7j/NBEe50M5CqYQJnRwtkjKMmuYgHBqtD1Ubbk5ww=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/htmlmixed/htmlmixed.min.js"
    integrity="sha512-HN6cn6mIWeFJFwRN9yetDAMSh+AK9myHF1X9GlSlKmThaat65342Yw8wL7ITuaJnPioG0SYG09gy0qd5+s777w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/keymap/vim.min.js"
    integrity="sha512-CRScbOTlIJVds3U03uRuDwsYvvq3qFtW5rR7bdlWMzyaKASpibWkS4qhUwE0mfNIpwRurtR3V7bKMLPTtjXusw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body style="height: 100%">
  <div>
    <br>
    <p class="html-label fixed no-select">Enter HTML Code Below</p>
    <div>
      <form>
        <label class="name-label z-index-10 fixed no-select" for="Name">Name</label>
        <input class="name-input z-index-10 fixed border-radius-10 border-light-blue" type="text" id="nameBox"
          autocomplete="off" ;><br><br>
        <input type="button" onclick="postNewPage()" class="create-page-btn fixed hover border-radius-10 border-light-blue" value="Create Page">
        <div style="position: fixed; top: 100px; width: 100%; height: 100%;">
          <div id="scrollToTop" class="scroll-to-top"></div>
          <textarea id="codeMirror" oninput="return myKeyPress(event)" class="CodeMirror"></textarea>
        </div>
      </form>
    </div>
  </div>

  <div class="page-btns">
    <input type="button" class="page-btn fixed hover z-index-10 border-radius-10 border-light-blue" value="My Pages"
      onclick="modalActions('pages','open')">
  </div>

  <div class="gutter fixed box-shadow" id="gutter">
    <div class="fixed border-radius-10 light-blue-gradient settings no-select" onclick="modalActions('options','open')"><span class="material-icons"
        style="height: 60px; width: 60px; font-size: 50px; margin-left: 5px; margin-top: 10px;" class="no-select">settings</span></div>
  </div>
  </div>

  <div class="top-bar fixed width-100 box-shadow dark-blue-gradient"></div>

  <div class="modal-container width-100 box-shadow">
    <div id="pages" class="modal fixed border-radius-10 dark-blue-gradient">
      <div class="modal-content">
        <hr class="modal-line border-light-blue">
        <span class="my-modal-title no-select">My Pages</span>
        <span class="close no-select" onclick="modalActions('pages','close')">&times;</span>
        <div id="delete-buttons"></div>
      </div>
    </div>
  </div>

  <div class="modal-container width-100 box-shadow">
    <div id="options" class="small-modal fixed border-radius-10 dark-blue-gradient">
      <div class="modal-content">
        <hr class="modal-line border-light-blue">
        <span class="my-modal-title no-select">Options</span>
        <span class="close no-select" onclick="modalActions('options','close')">&times;</span>
        <button id="switchKeyMap" class="modal-btn fixed border-radius-10 border-light-blue" onclick="changeKeyBindings()">Switch to Vim</button>
      </div>
    </div>
  </div>

  <div class="top-center-items">
    <div class="justify-content-center">
      <h1 class="page-h1 fixed border-radius-10 no-select">page</h1>
      <p class="info fixed">Make a new public webpage at [your-ship-url]/apps/page/[name]</p>
    </div>
  </div>

  <div class="bottom-right-items fixed">
    <div class="bottom-right-item no-select border-radius-10 light-blue-gradient" onclick="zoom('up')">
      <span class="material-icons icon fixed">zoom_in</span>
    </div>
    <div class="bottom-right-item no-select border-radius-10 light-blue-gradient" onclick="zoom('down')">
      <span class="material-icons icon fixed">zoom_out</span>
    </div>
    <div class="bottom-right-item no-select border-radius-10 light-blue-gradient" id="topBtn"
      onclick="jumpToLine(0);"><span class="material-icons icon fixed">arrow_upward</span></div>
  </div>
  <script>

    //UI Functions

    var fontSize = 16;

    getState()
      .then((state) => renderPage(state))

    var codeMirror = CodeMirror.fromTextArea(document.querySelector('#codeMirror'), {
      lineNumbers: true,
      mode: 'htmlmixed',
      theme: "rubyblue",
      gutters: ["CodeMirror-linenumbers", "CodeMirror-lint-markers"],
      lint: true,
      lineWrapping: true,
      autoCloseTags: true,
      autoCloseBrackets: true,
      matchBrackets: true,
      autoRefresh: true,
      viewportMargin: Infinity,
      vimMode: false,
      keyMap: "default",
      extraKeys: {
        "Ctrl-Space": "autocomplete",
        "Ctrl-Q": function (cm) {
          cm.foldCode(cm.getCursor());
        }
      },
    });

    codeMirror.on("change", function (cm, change) {
      text = cm.getValue();
      namebox = document.getElementById("nameBox").value;
      console.log(text);
      console.log("nb",namebox);
      saveText()
    });

    function changeKeyBindings() {
      if (codeMirror.getOption("keyMap") !== "vim") {
        codeMirror.setOption("keyMap", "vim");
        codeMirror.setOption("vimMode", true);
        document.getElementById("switchKeyMap").innerHTML = "Switch to Default";
      } else {
        codeMirror.setOption("keyMap", "default");
        codeMirror.setOption("vimMode", false);
        document.getElementById("switchKeyMap").innerHTML = "Switch to Vim";
      }
    }

    function zoom(arrow) {
      if (arrow == 'up' && fontSize < 20) {
        fontSize += 1;
        $('.CodeMirror').css('font-size', fontSize + 'px')
      } else if (arrow == 'down' && fontSize > 10) {
        fontSize -= 1;
        $('.CodeMirror').css('font-size', fontSize + 'px')
      }
      codeMirror.refresh();
    };

    codeMirror.setSize("100%", "92%");

    function getLineNumber(textarea, indicator) {
      indicator.innerHTML = document.getElementsByTagName("textarea")[0].value.substr(0, document.getElementsByTagName("textarea")[0].selectionStart).split("\n").length;
    }

    function saveText() {
      namebox = document.querySelector("#nameBox").value;
      console.log(namebox)
    }

    function modalActions(modal, status) {
      var modal = document.getElementById(modal);
      if (status == "open") {
        modal.style.opacity = "1";
        modal.style.zIndex = "4";
      } else if (status == "close") {
        modal.style.opacity = "0";
        modal.style.zIndex = "-4";
      }
    }

    function jumpToLine(i) {
      codeMirror.setCursor(i);
      window.setTimeout(function () {
        editor.setLineClass(i, null, "center-me");
        var line = $('.CodeMirror-lines .center-me');
        var h = line.parent();

        $('.CodeMirror-scroll').scrollTop(0).scrollTop(line.offset().top - $('.CodeMirror-scroll').offset().top - Math.round($('.CodeMirror-scroll').height() / 2));
      }, 200);
      document.getElementById("scrollToTop").scrollTop = 0;
    }

    //HTTP Requests

    function post(tag, data) {
      fetch('/apps/page', {
        method: 'POST',
        body: JSON.stringify({ [tag]: data })
      })
      console.log(JSON.stringify({ [tag]: data }))
      location.reload()
    }

    async function getState() {
      const response = await fetch('/apps/page/state')
      return response.json()
    }

    function postNewPage() {
      var nb = document.getElementById("nameBox").value;
      var text = codeMirror.getValue();
      post("new-page", [nb, text]);
      console.log(namebox)
    }

    function postDeletePage() {
      var page = event.currentTarget.myPage;
      post("delete-page", page);
    }

    function renderPage(state) {
      const deletions = document.getElementById("delete-buttons");

      for (var i = 0; i < state.length; i++) {
        const page = document.createElement("div");
        page.className = "page light-blue-border border-radius-10";
        deletions.appendChild(page);

        const deleteButton = document.createElement("button");
        deleteButton.className = "page-list-item";
        deleteButton.innerHTML = "<span class='pages-title'>"+state[i][0]+"</span><button class='del'>Delete</button>";
        deleteButton.myPage = state[i][0]
        deleteButton.addEventListener('click', postDeletePage);
        page.appendChild(deleteButton);
      }
    }

    //For testing delete button UI
    /*
    var page = [];

    page = [["Test", "Test"],["Test", "Test"],["Test", "Test"],["Test111111111111111", "Test"], ["Test", "Test"],["Test", "Test"],["Test", "Test"],["Test", "Test"],["Test", "Test"],["Test", "Test"],["Test", "Test"]]

    renderPage(page)
    */
  </script>
</body>